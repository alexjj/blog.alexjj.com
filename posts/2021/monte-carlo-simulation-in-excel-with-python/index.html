<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Monte Carlo Simulation in Excel with Python &#183; alexjj.com</title><meta name=title content="Monte Carlo Simulation in Excel with Python &#183; alexjj.com"><meta name=description content="Simulating the possible with python and excel"><link rel=canonical href=https://alexjj.com/posts/2021/monte-carlo-simulation-in-excel-with-python/><link type=text/css rel=stylesheet href=/css/main.bundle.min.25d341a2871e5f761d78620fbdb676a4a1fb2a7fa53b33fb570092cb62a472c0.css integrity="sha256-JdNBooceX3YdeGIPvbZ2pKH7Kn+lOzP7VwCSy2KkcsA="><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.84ea74257c78d510b25594590b1aca93c37a6877605bb4b7493b685aac753491.js integrity="sha256-hOp0JXx41RCyVZRZCxrKk8N6aHdgW7S3STtoWqx1NJE=" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Monte Carlo Simulation in Excel with Python"><meta property="og:description" content="Simulating the possible with python and excel"><meta property="og:type" content="article"><meta property="og:url" content="https://alexjj.com/posts/2021/monte-carlo-simulation-in-excel-with-python/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-25T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Monte Carlo Simulation in Excel with Python"><meta name=twitter:description content="Simulating the possible with python and excel"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Monte Carlo Simulation in Excel with Python","headline":"Monte Carlo Simulation in Excel with Python","abstract":"Simulating the possible with python and excel","inLanguage":"en","url":"https:\/\/alexjj.com\/posts\/2021\/monte-carlo-simulation-in-excel-with-python\/","author":{"@type":"Person","name":"Alex Johnstone"},"copyrightYear":"2021","dateCreated":"2021-11-25T00:00:00\u002b00:00","datePublished":"2021-11-25T00:00:00\u002b00:00","dateModified":"2021-11-25T00:00:00\u002b00:00","keywords":["Python","Excel"],"mainEntityOfPage":"true","wordCount":"1214"}]</script><meta name=author content="Alex Johnstone"><link href=mailto:alex@alexjj.com rel=me><link href=https://www.flickr.com/photos/alexjj/ rel=me><link href=https://github.com/alexjj rel=me><link href=https://linkedin.com/in/ajjohnstone rel=me><link href=https://fosstodon.org/@alexjj rel=me><link href=https://steamcommunity.com/id/captainlag/ rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a href=/ class=mr-2><img src=/img/cat-logo.png width=50 height=58 class="max-h-[10rem] max-w-[10rem] object-scale-down object-left" alt=alexjj.com loading=lazy></a>
<a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>alexjj.com</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 ltr:text-right rtl:text-left sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1"><a href=/notes/ title=Notes><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Notes</span></a></li><li class="group mb-1"><a href=/about/ title="About me"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1"><a href=https://wiki.alexjj.com title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Wikiüåê</span></a></li><li class="group mb-1"><button id=search-button-m0 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span></button></li></ul></div></label><ul class="hidden list-none flex-row ltr:text-right rtl:text-left sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/notes/ title=Notes><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Notes</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/about/ title="About me"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=https://wiki.alexjj.com title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Wikiüåê</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-m1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Welcome to my site</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2021/monte-carlo-simulation-in-excel-with-python/>Monte Carlo Simulation in Excel with Python</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Monte Carlo Simulation in Excel with Python</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-11-25 00:00:00 +0000 UTC">25 November 2021</time><span class="px-2 text-primary-500">&#183;</span><span>1214 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/alexjj/alexjj.com/tree/main/content/posts/2021/monte-carlo-simulation-in-excel-with-python/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></a></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-prose grow"><p>There are quite a few blogs that show you how to do Monte Carlo simulations using python. A very accessible one is from <a href=https://pbpython.com/monte-carlo.html target=_blank rel="noreferrer noopener">Practical Business Python</a>. Always a great site for python in the workplace for non-devs. However, I couldn&rsquo;t find one that did just what I wanted, namely, take a model I&rsquo;d already built in Excel and then apply some randomness and plot the S-curve (cumulative distribution function).</p><p>Maybe if I&rsquo;d searched more I&rsquo;d find one but instead I just got on with it. I also used to have some software at work that did this for me, it was an add-on to Excel but work stopped paying for it and I found it hard to justify it (it&rsquo;s an Oracle product so no doubt pricey). Plus I always love an excuse to try and learn a bit more python.</p><h2 id=background class="relative group">Background <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#background aria-label=Anchor>#</a></span></h2><p>If you don&rsquo;t know, Monte Carlo simulation is a way to capture uncertainity. If a friend is driving to your house, 50 miles away, and they travel at 50 mph it&rsquo;ll take then one hour right? Well, not always. Maybe they are keen on the gas and drive faster, or maybe there&rsquo;s an accident and they get stuck. You just never know. So you could use monte carlo to say that their average journey speed could be from 40-60 mph, then you randomly sample many many times from that range and work out the time it takes. Do it 10,000 times and you then have 10,000 results that you can draw estimates from, e.g. the average time. You can also plot the results and show the whole range.</p><h2 id=tools class="relative group">Tools <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tools aria-label=Anchor>#</a></span></h2><p>The main python tools to get this working is <a href=https://numpy.org/ target=_blank rel="noreferrer noopener">numpy</a> for the random sampling and <a href=https://www.xlwings.org/ target=_blank rel="noreferrer noopener">xlwings</a> for interacting with Excel. Like all python libraries, these tools do <strong>way</strong> more than just what I need. I also used pandas, seaborn and matplotlib. Probably unnecessary but they&rsquo;re quick to work with as I already know the gist of them.</p><p>Then of course there&rsquo;s Excel, which needs no introduction. I&rsquo;d already built my deterministic model in Excel, where all my inputs were in one table that could be changed and then the outputs were in another to be read.</p><p>There&rsquo;s always going to be the choice of what do you do in python and what do you do in Excel. As I&rsquo;d started in Excel I didn&rsquo;t want to waste time recreating stuff in python so all the calculations are in Excel. This is slow (but still fast enough for my use case). Depending on how advanced or complex your model becomes it may be better to move more of it to Excel. The trade off with this is now only you can use it or understand it.</p><p>Before I forget, there&rsquo;s also VS Code. I use it at work as it&rsquo;s free, I can install it without Admin rights and IT department haven&rsquo;t questioned me on it (yet!), unlike PyCharm ü§î. I like to make use of the #%% cell divider in it. Partially as I&rsquo;d been using this for a long time with Spyder (before VS Code existed) and also as it seems like a better way to work vs. notebooks. At least for me.</p><p>As always the documentation of the libraries is a great place to start - often the best place before you jump to tutorials.</p><h2 id=the-randomness class="relative group">The Randomness <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-randomness aria-label=Anchor>#</a></span></h2><p>Your uncertainity takes shape in many different ways. Sometimes is a continuous range, like our speed example before, or it&rsquo;s discrete, like picking your starter Pok√©mon. In fact whatever the uncertainity is, numpy has a <a href=https://numpy.org/doc/stable/reference/random/index.html target=_blank rel="noreferrer noopener">method</a> to help you represent it. I actually think working out what your uncertainity looks like is the hardest part of all of it. Perhaps you could even have uncertainity on the uncertainity&mldr;Generally you want to ask an expert, maybe yourself, maybe someone else in your company, or whatever you can find online that seems reasonable. You can, of course, just try different ones in your model and see if it actually makes a difference to the decision you&rsquo;re trying to make.</p><p>I ened up using <code>choice</code> and <code>uniform</code> distributions. Choice being my starter Pok√©mon, and uniform distribution being a range of numbers but they&rsquo;re all equally likely to be picked.</p><p>My choice was actually choosing a range of numbers in Excel which would all change depending on what choice was picked.</p><h2 id=the-code class="relative group">The Code <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-code aria-label=Anchor>#</a></span></h2><p>So in all its glory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>seaborn</span> <span class=k>as</span> <span class=nn>sns</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>xlwings</span> <span class=k>as</span> <span class=nn>xw</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>set_style</span><span class=p>(</span><span class=s1>&#39;whitegrid&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Setup</span>
</span></span><span class=line><span class=cl><span class=n>excel</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&#34;myexcel.xlsx&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wb</span> <span class=o>=</span> <span class=n>xw</span><span class=o>.</span><span class=n>Book</span><span class=p>(</span><span class=n>excel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sheet</span> <span class=o>=</span> <span class=n>wb</span><span class=o>.</span><span class=n>sheets</span><span class=p>[</span><span class=s1>&#39;Control Sheet&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>iterations</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>POWER_LOWER</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=n>POWER_UPPER</span> <span class=o>=</span> <span class=mi>120</span>
</span></span><span class=line><span class=cl><span class=n>CAPITAL_LOWER</span> <span class=o>=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=n>CAPITAL_HIGHER</span> <span class=o>=</span> <span class=mi>30000</span>
</span></span><span class=line><span class=cl><span class=n>CO2_OPTIONS</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>npv</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>power_price</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>low</span><span class=o>=</span><span class=n>POWER_LOWER</span><span class=p>,</span> <span class=n>high</span><span class=o>=</span><span class=n>POWER_UPPER</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>capital_cost</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>low</span><span class=o>=</span><span class=n>CAPITAL_LOWER</span><span class=p>,</span> <span class=n>high</span><span class=o>=</span><span class=n>CAPITAL_HIGHER</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>co2_price</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>CO2_OPTIONS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sheet</span><span class=o>.</span><span class=n>range</span><span class=p>(</span><span class=s1>&#39;B3&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>power_price</span> <span class=o>/</span> <span class=mi>80</span>
</span></span><span class=line><span class=cl>    <span class=n>sheet</span><span class=o>.</span><span class=n>range</span><span class=p>(</span><span class=s1>&#39;B4&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>capital_cost</span>
</span></span><span class=line><span class=cl>    <span class=n>sheet</span><span class=o>.</span><span class=n>range</span><span class=p>(</span><span class=s1>&#39;B9&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>co2_price</span>
</span></span><span class=line><span class=cl>    <span class=n>npv_new</span> <span class=o>=</span> <span class=n>sheet</span><span class=o>.</span><span class=n>range</span><span class=p>(</span><span class=s1>&#39;B7&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>npv</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>npv_new</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;NPV10 ¬£MM&#39;</span><span class=p>:</span> <span class=n>npv</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>P90</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>quantile</span><span class=p>(</span><span class=mf>0.9</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>P50</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>quantile</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>P10</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>quantile</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>EV</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>mean</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>displot</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;ecdf&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;EV: ¬£</span><span class=si>{</span><span class=n>EV</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>MM, P10: ¬£</span><span class=si>{</span><span class=n>P10</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>MM, P50: ¬£</span><span class=si>{</span><span class=n>P50</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>MM, P90: ¬£</span><span class=si>{</span><span class=n>P90</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>MM&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>I made a few controls at the top so I could adjust the ranges of things. Fairly basic stuff otherwise, which I&rsquo;m sure can be done better but was good enough for me. Being so simple makes it pretty easy to understand, even if you&rsquo;ve never used these libraries before.</p><p>The whole thing is a loop that does the random sampling, insert those values into excel, excel then recalculates, then it takes the answer out and appends it to a list. Repeat that <code>iterations</code> times and there&rsquo;s my data.</p><p>I create a pandas dataframe (probably lazy and it could be done in numpy but as I said, lazy.) from the list and then calculate some metrics from it. The P values are commonly used at work to express the range. Where P90 meaning 90% probability that the value is ‚â§ X. Or often viewed as most optimistic result, with P10 therefore being the most pessimistic result. Actually, I&rsquo;ve seen companies define these in reverse so check before you confuse people.</p><p>Seaborn has a handy empirical cumulative distribution function (ecdf), that saves me thinking anything whatsoever (that&rsquo;s the whole objective whilst at work right?). So I make one of those for the PowerPoint, and print out the final numbers in a nice line.</p><p>The other nice thing with VS Code is the data viewer. I can save the plot to a file and copy and paste the table of results straight from it without having to write it to a file first. Tiny things like that make life so much easier.</p><h2 id=conclusion class="relative group">Conclusion <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>So pretty straight forward to make your deterministic Excel model into a fully probabilistic model capturing all the uncertainity and demonstrating all the potential outcomes that can happen. For free, in about 30 minutes of work.</p><p>I think probabilistic models should be used more often. Very rarely is it that everything is always known exactly and whilst your calculation isn&rsquo;t wrong, it&rsquo;s only one possible outcome. Better to give your decision maker (or yourself) a range of outcomes than just one. Tell them &ldquo;they&rsquo;re buying the curve&rdquo;. Then hope the final result actually lands on the curve üòÖ</p></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/2021/my-favourite-teapot/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">My favourite teapot ü´ñ</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-09-27 00:00:00 +0000 UTC">27 September 2021</time></span></span></a></span>
<span><a class="group flex text-right" href=/posts/2021/generating-lots-of-tiddlers/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Generating lots of tiddlers</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-12-15 00:00:00 +0000 UTC">15 December 2021</time></span></span>
<span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="group mb-1 ltr:text-right rtl:text-left sm:mb-0 sm:me-7 sm:last:me-0"><a href=/tags/ title=Tags><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400"><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.en target=_blank rel="noreferrer noopener">CC Attribution-Share Alike 4.0 International</a></p></div></div><a rel=me href=https://fosstodon.org/@alexjj></a></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://alexjj.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>